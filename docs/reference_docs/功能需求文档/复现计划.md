# 油茶籽含油率复现计划

## 1. 目标与预期成果
- 复现《基于高光谱成像的油茶籽含油率检测方法》中的实验流程，重建400–1 000 nm与900–1 700 nm双波段采集、变量筛选与PLSR建模。
- 输出高光谱数据处理管线、模型性能对照（R²、RMSEP、RMSECV）及含油率伪彩色可视化结果。
- 形成可复用的代码框架、数据管理规范与实验记录，支撑后续算法改进。

## 2. 数据资源与采集计划
- 已有资料：论文全文、需求文档；暂缺原始光谱数据与含油率实测值。
- 原始数据采集：规划两套系统（Spectral Set Ⅰ：400–1 000 nm；Set Ⅱ：900–1 700 nm）。按照论文参数设置：
  - Set Ⅰ：距样品300 mm，曝光1.2 ms，位移台0.6014 mm/s，分辨率800×664，扫描长度200 mm。
  - Set Ⅱ：距样品300 mm，曝光7.5 ms，位移台2.2568 mm/s，分辨率640×542，扫描长度200 mm。
- 样本准备：采集至少109颗油茶果，记录形态参数，次日剥壳取籽；逐粒采三颗取平均光谱。
- 含油率标定：使用NAI ZFCDY 6Z索氏抽提仪，按GB 5009.6—2016执行；每粒质量约2 g，抽提6 h，干燥称量后计算含油率。

## 3. 实验流程
1. **系统标定**：采集白板与暗场图像，按公式`Re = (R0 - D)/(W - D)`完成黑白校正；剔除噪声波段（SetⅠ保留416.6–994.9 nm，SetⅡ保留1038.3–1564.9 nm）。
2. **ROI提取与数据整理**：对每颗籽获取ROI平均光谱；将光谱与含油率、采样元信息写入统一数据表（CSV/Parquet）。
3. **异常样本检测**：Monte Carlo交叉验证（5000次、训练/预测=2∶1）筛除异常样本，目标保留约102份。
4. **预处理对比**：实现原始、MSC、SNV、SG、Normalize、Detrend六条管线，基于PLSR评估潜变量数（最小RMSECV）。
5. **特征波长筛选**：复现SPA、CARS、PSO、ACO、SA、iRF、GA；采用论文参数（如GA：代数150、种群64、变异率1%；PSO：种群20、迭代1000，F=R²；ACO：蚁群30、迭代100、窗口1，F=(1+QRMSECV)/R²等），输出各自特征波段。
6. **模型训练与评估**：对全波段与筛选波段分别训练PLSR；记录R²c、R²p、RMSEC、RMSEP、RMSECV；重点验证SetⅡ + GA组合。
7. **可视化复现**：将最佳模型应用至高光谱立方体，生成含油率伪彩色图，分析边缘误差并与论文图4对照。
8. **结果汇总**：撰写实验记录（含数据分布、模型指标、误差分析），提供再现性说明。

## 4. 工具与环境
- 硬件：双波段高光谱成像系统、电控位移台、标准白板、索氏抽提装置、恒温干燥箱。
- 软件：ENVI或SpectralPython处理原始立方体；Python 3.10+（numpy、scipy、pandas、scikit-learn、matplotlib、spectral、pykrige）实现算法；备选Matlab脚本以对照。
- 版本控制：Git记录代码与实验配置；数据存于`data/raw`、`data/processed`分层，>50 MB文件外部存储并以元数据链接。

## 5. 时间与任务拆分（参考）
- 第1周：设备确认、采样计划、环境搭建、脚本框架初始化。
- 第2周：完成数据采集与含油率标定，整理原始光谱与标签。
- 第3周：实现预处理、异常检测、全波段PLSR，复核指标。
- 第4周：实现七种变量选择、完成降维建模及性能对照。
- 第5周：像素级可视化、误差分析、撰写实验报告与文档。

## 6. 风险与应对
- **数据缺失**：若无法立即获取原始光谱，先使用公开近红外数据进行算法验证，再迁移至实测数据。
- **算法复现难度**：优先使用论文参数，必要时查阅原作者参考文献；全部实现统一接口便于调试。
- **设备差异**：记录实际设备参数，必要时重新优化曝光与扫描速度；对比论文指标时注明差异。
- **模型泛化**：引入交叉验证与留一法评估稳定性；必要时增加正则化或多模型融合。

## 7. 项目初始架构建议
```
data/
  raw/
  processed/
  spectra/
  labels/
docs/
  reference_docs/
    功能需求文档/
      含油量检测需求.md
      复现计划.md
    实验记录/ (拟新增)
notebooks/
  exploration/
  visualization/
src/oil_content_detection/
  acquisition/
  preprocessing/
  feature_selection/
  models/
  visualization/
  utils/
tests/
  test_preprocessing.py
  test_feature_selection.py
  test_models.py
```
- 在`scripts/`新增批处理命令（如`ingest_hsi.py`、`train_plsr.py`）。
- 使用`config/`保存波段、参数设定，便于多实验对照。
